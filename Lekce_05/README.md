# 5. lekce: Enterprise networking
Pokud jste cloud-native startup, malá firma nebo gigant provozující nějakou hodně speciální technologii, možná využijete nativní cloudové služby bez složitého propojování sítí a integrace bezpečnostních prvků. Pro většinu enterprise firem, zejména v regulovaných sektorech jako je bankovnictví či zdravotnictví, budete ale nejspíše nasazovat enterprise networking. Segmentované a vysoce zabezpečené prostředí.

Nejprve si pojděme pár pojmů a rovnou si je budeme ukazovat na příkladu.

- **VPC/VNET** je základní stavební kámen sítě v cloudu, který virtuální síť propojující privátním způsobem vaše zdroje s možností ji bezpečně propojit s privátní sítí mimo daný cloud (on-premises či další cloud). U Azure a AWS je regionální, u GPC globální.
- **Subnet** je podsložkou VPC/VNET, která může mít vlastní nastavení (např. filtrování provozu s ACL, směrovací tabulky). V Azure a GCP funguje subnet přes zóny dostupnosti (AZ) jednoho regionu, u AWS je subnet vždy v jedné AZ.
- **Hub-and-spoke** topologie a inspekce na firewallu - nejčastější nasazení enterprise sítí, obvykle jedna hvězdice per region. V Azure s použitím například Virtual WAN + Azure Firewall, v AWS například s Transit Gateway + Network Firewall, v GCP například s VPC Peering  Cloud Router + Cloud NGFW.
- **Security Group** je jednoduchý mini-firewall, který se aplikuje na úrovni instance (v případě Azure i na subnetu, u AWS je na subnetu Network ACL). U Azure lze mít jen jednu Network Security Group na instanci a mít v ní pojmenované objekty (Application Security Group), AWS a GCP to řeší přes vícero SG, které mohou na sebe vzájemně odkazovat. Obvykle se tento koncept používá pro mikrosegmentaci a často je ve správě aplikačního týmu, zatímco síťový a bezpečnostní tým řeší pravidla na centrálním firewallu (prostupy mezi aplikačními celky, prostředími, do Internetu apod.)
- **VPN** (Virtual Private Network) - propojení dvou sítí přes veřejnou síť (Internet) tak, aby se chovaly, jako by byly propojeny přímým kabelem. Obvykle se používá pro propojení on-premises s cloudu (např. Azure VPN Gateway, AWS VPN Gateway, GCP Cloud VPN).
- **SD-WAN** (Software Defined Wide Area Network) je technologie, která umožňuje propojit více sítí (např. pobočky firmy) přes veřejnou síť (Internet) tak, aby se chovaly, jako by byly propojeny přímým kabelem. Obvykle se používá pro propojení poboček firmy mezi sebou a s centrálním datovým centrem a cloudem. Jde tedy o soustavu VPN, které umožňují chytře a dynamicky sestavovat tunely a řídit kudy co poteče.
- **Leased line** (např. MPLS) je privátní linka mezi dvěma místy, která je pronajatá od telekomunikační společnosti. Jde o nejdražší, ale nejrychlejší a nejstabilnější řešení. V Azure se jmenuje ExpressRoute, v AWS Direct Connect, v GCP Cloud Interconnect.

Poznámky k komunikaci do a z Internetu:
- **Floating IP** nebo také jen Public IP je situace, kdy se veřejná IP adresa přiřadí přímo k VM a cloud pak provádí tzv. IP NAT (1:1)
- **SNAT** (Source NAT) je situace, kdy víc instancí sdílí jednu veřejnou IP adresu a cloud provádí tzv. Source NAT (přemapování TCP/UDP portů na sdílenou IP). K tomu je potřeba například přiřadit **NAT Gateway** nebo použít outbound pravidla na **Load Balanceru** či síťové řešení nativní (např. Azure Firewall) nebo třetí strany (Network Virtual Applicance jako je Checkpoint, Cisco, Fortinet, Palo Alto apod.).
- **DNAT** (Destination NAT) je situace, kdy veřejná IP adresa směřuje na interní IP adresu. To se obvykle používá pro přesměrování portů na interní služby (např. veřejná IP adresa na portu 443 směřuje na interní IP adresu na portu 8443). K tomu lze využít opět Load Balancer, nativní firewall řešení nebo NVA. To jsme rozebírali v předchozí lekci.

**Napojení platformních služeb** do privátní sítě je rovněž složité téma, které můžeme rozdělit na dvě situace:
- První je **sdílená** neboli multi-tenantní služba, kdy její kouzlo je právě v tom, že provider má gigantický cluster a jeho služby vám nabízí, což přináší nízkou cenu. V tomto případě není schopen tuto komponentu umístit do vaší sítě - z principu věci. Pokud vyžadujete přístup ke službě po privátní síti, musí do vaší sítě vložit nějakou "červí díru", něco jako virtuální proxy krabičku s privátní IP, které provoz zabalí do tunelu a odveze ke službě. Této technice se obvykle říká Private Link technologie a je zhmotněna v Azure Private Endpoints, AWS VPC Endpoints nebo Private Google Access. 
- Druhá situace je **dedikovaná** služba, která je nasazena ve vašem prostředí. V takovém případě je problém v tom, že nody jsou sice určeny jen pro vás, ale provider je musí být schopen nasazovat a spravovat (to je podstata služby) a pokud jsou ve vaší síti, tak se k nim nedostane. To se často řeší nutností otevřít do vaší sítě určité prostupy nebo dnes čím dál častěji má provider nějaký "out-of-band" mechanismus, jak node spravovat mimo vaši síť (představte si například, že má node nějakou další tajnou síťovou kartu pro správcovskou síť nebo že tam není přímá komunikace, ale node je ve skutečnosti kontejner jehož monitoring a konfigurace probíhá přes orchestrační platformu a konfigurační manifesty v pull režimu).

Pro úspěšné fungování napříč cloudy a z on-premises přes privátní linky je typicky nutné dořešit DNS integraci. Obvykle to spočívá v nasazení nativního nebo vlastního DNS forwarderu v cloudu (jako cíl pro onprem forwarder a také pro forwarding dotazů na on-prem domény).
